@(
        user: org.intracer.wmua.User, /* logged in user */
        asUserId: Long, /* viewing files of user with asUserId id  */
        asUser: org.intracer.wmua.User, /* viewing files of user asUser  */
        pageFiles: Seq[org.intracer.wmua.ImageWithRating],
        regionFiles: Seq[org.intracer.wmua.ImageWithRating],
        page: Int, /* not used */
        round: Option[org.intracer.wmua.Round],
        rounds: Seq[org.intracer.wmua.Round],
        rate: Option[Int],
        region: String = "all",
        byRegion: Map[String, Int],
        outputFormat: String = "wiki",
        wrapInTable: Boolean
)(implicit flash: Flash, lang: Lang, messages: Messages)

@wrapInIf(tag: String, condition: Boolean)(content: Html) = {
@if(condition) {
    <@tag>
        @content
    </@tag>
} else {
    @content
}
}

@cell(content: Html) = { @wrapInIf("td", wrapInTable)(content) }

@row(content: Html) = { @wrapInIf("tr", wrapInTable)(content) }

@main("filelist", user, asUserId, asUser, round, rounds, rounds, gallery = false, rate, region) {

    <div class="container">

    @defining(round.flatMap(_.id).getOrElse(0L)) { roundId =>

        @regionNav({ region: String => s"/filelist/round/$roundId/user/$asUserId/region/$region/page/1${rateParam(rate).body}" }, round, region, byRegion)

    <div class="row">

        @defining(s"<!-- Wiki Loves Eath 2014, " +
                s"Round ${round.fold("None")(_.description)}, " +
                s"Juror: ${Option(asUser).fold("All")(u => u.fullname)} " +
                s"${KOATUU.regions.get(region).fold("")(name => s", Region: $name")}. --> ") { t => @t <br/> }

    <div contenteditable="true">

        @defining(round.map(_.jurors).get) { jurors =>

        @if(wrapInTable) {
            <table class="table table-striped table-condensed">
                <thead>
                    <th>
                        File
                    </th>
                    <th>
                        @if(asUserId == 0) {Overall <br>}
                        Rating
                    </th>

                    @if(asUserId == 0) {
                        @for(juror <- jurors) {
                            <th>
                               @juror.fullname
                            </th>
                        }
                    }

                </thead>
                <tbody>
                }

            @for(file <- if(!wrapInTable) pageFiles else pageFiles.sortBy(-_.totalRate(round.get))) {
                @row {
                    @cell {

                        @outputFormat match {
                            case "wiki" => {
                                <a href="https://commons.wikimedia.org/wiki/@file.title" target="_blank">@file.title</a> <br/>
                            }
                            case "html" => {
                                @defining(
                                    s"""<a href="https://commons.wikimedia.org/wiki/${file.title}" target="_blank"><img
            src="${controllers.Global.resizeTo(file.image, controllers.Global.gallerySizeX, controllers.Global.gallerySizeY)}"></a>"""
                                ) { str => @str <br/> }
                            }
                        }
                    }

                    @if(wrapInTable) {
                        <td>@file.rateString(round.get)</td>
                    }
                    @if(asUserId == 0) {
                        @for(juror <- jurors) {
                            <td>
                                @file.selection.find(_.juryId == juror.id.get).map(_.rate.toString).getOrElse("")
                            </td>
                        }
                    }

                }
            }
        }
        @if(wrapInTable) {
        </tbody>
        </table>
        }
    </div>
    </div>
    </div>
    }
}
